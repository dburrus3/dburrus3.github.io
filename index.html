<!DOCTYPE html>
<html>
<head>
    <title>Chicago Crime Statistics</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="https://rawgit.com/susielu/d3-annotation/master/d3-annotation.min.js"></script>
    <style>
        rect {stroke: white;}
    </style>
</head>

<body onload="init()">
    <h1>A Tale of Two Cities</h1>
    <h2>Chicago’s crime rate is better – and worse – than you may think</h2>
    <p>Chicago is considered by some to be America’s most dangerous city. In a mid-2021 survey by the New York Times, 53% of readers thought Chicago had the highest murder rate in America. A former President described the city as “worse than Afghanistan”.</p>
    <p>The data tell a different story.</p>
    <p>Chicago is the third-largest city in America, but its crime rate just is in the middle of the pack. Of the 30 largest U.S. cities, Chicago ranks 15th based on crimes per 100,000 residents. Of the 100 largest cities, Chicago is ranked 44th.</p>
    <div id="container">Here:</div>
    
<script>
    
// init function
async function init() {
    const datax = await d3.csv("https://flunky.github.io/cars2017.csv");


// load data
const popul = await d3.csv("https://raw.githubusercontent.com/dburrus3/dburrus3.github.io/main/data/CityPopul.csv");
const rates = await d3.csv("https://raw.githubusercontent.com/dburrus3/dburrus3.github.io/main/data/CityCrimeRate.csv");

var labels1 = popul.map(d => d.City)
var data1  = popul.map(d => d.Popul2020)
var numPts1 = data1.length
var maxData1 = Math.max.apply(null, popul.map(function (x) { return x.Popul2020; }))
var barChgo1 = labels1.indexOf("Chicago, IL");

var labels2 = rates.map(d => d.City)
var data2  = rates.map(d => d.Crimes100K)
var numPts2 = data2.length
var maxData2 = Math.max.apply(null, rates.map(function (x) { return x.Crimes100K; }))
var barChgo2 = labels2.indexOf("Chicago, IL");

// set chart widths, heights, origin locations, etc.
const screenWd = window.innerWidth;
const screenHt = window.innerHeight; 
var marginWd = Math.round(screenWd * 0.05);
var marginHt = Math.round(screenHt * 0.05);
var marginLabel = Math.round(screenWd * 0.08);
var chartWd = Math.round((screenWd - 3 * marginWd) / 2 - marginLabel);
var chartHt = Math.round(screenHt * 0.50);
var chart1X = marginWd + marginLabel;
var chart1Y = marginHt;
var chart2X = marginWd * 2 + chartWd + 2 * marginLabel;
var chart2Y = chart1Y;
const barSpc = 1;
const colorChicago = "red";
const colorOther = "lightblue"

// Calculate the scale for each chart
var scaleX1 = d3.scaleLinear()
    .domain([0, maxData1])
    .range([0, chartWd]);

var scaleY1 = d3.scaleBand()
    .domain(labels1)
    .range([0, chartHt]);

var scaleX2 = d3.scaleLinear()
    .domain([0, maxData2])
    .range([0, chartWd]);

var scaleY2 = d3.scaleBand()
    .domain(labels2)
    .range([0, chartHt]);

// SVG container for both Chart 1 and Chart 2
const svg = d3.select("body")
    .append("svg")
    .attr("width", screenWd - 2 + marginWd)
    .attr("height", chartHt)
    .attr("id", "charts");

// Chart 1: horizontal bar chart of population by city
const chart1 = svg.append("g")
    .attr("transform","translate(" + chart1X + "," + chart1Y + ")");

chart1.selectAll("rect")
    .data(popul)
    .enter()
    .append("rect")
    .attr("x", 0)
    .attr("y", (_, i) => i * (chartHt / numPts1))
    .attr("width", (d) => scaleX1(d.Popul2020))
    .attr("height", chartHt / numPts1 - barSpc)
    .attr("id", "chart1")
    .attr("fill", (_, i) => (i === barChgo1) ? colorChicago : colorOther);

var axisX1 = svg.append("g")
    .attr("transform","translate(" + chart1X + "," + chart1Y + ")")
    .call(d3.axisTop(scaleX1)
        .tickFormat(d3.format("~s")).ticks(10));

var axisY1 = svg.append("g")
    .attr("transform","translate(" + chart1X + "," + chart1Y + ")")
    .call(d3.axisLeft(scaleY1));

// Chart 2: horizontal bar chart of all crimes per 100K residents
const chart2 = svg.append("g")
    .attr("transform","translate(" + chart2X + "," + chart2Y + ")");

chart2.selectAll("rect")
    .data(rates)
    .enter()
    .append("rect")
    .attr("x", 0)
    .attr("y", (_, i) => i * (chartHt / numPts2))
    .attr("width", (d) => scaleX2(d.Crimes100K))
    .attr("height", chartHt / numPts2 - barSpc)
    .attr("id", "chart2")
    .attr("fill", (_, i) => (i === barChgo2) ? colorChicago : colorOther);

var axisX2 = svg.append("g")
    .attr("transform","translate(" + chart2X + "," + chart2Y + ")")
    .call(d3.axisTop(scaleX2)
        .tickFormat(d3.format("~s")).ticks(10));

var axisY2 = svg.append("g")
    .attr("transform","translate(" + chart2X + "," + chart2Y + ")")
    .call(d3.axisLeft(scaleY2));

        
// Features of the annotation
var annotations = [
  {
    note: {
      title: "Chicago",
      label: "3rd largest population",
      align: "middle",
      wrap: 100,
      padding: 3      
    },
    x: 210,
    y: 100,
    dy: 20,
    dx: 20
  }
]

// Add annotation to the chart
var makeAnnotations = d3.annotation().annotations(annotations)

d3.select("#charts")
  .append("g")
  .call(makeAnnotations)

}

// -------------------------------------------
// these "write" statements are only for debugging 

    // code check: write values to the screen
    const texts = [
        "Screen width: " + screenWd + ", height: " + screenHt + ".",
        "Margin width: " + marginWd + ", height: " + marginHt + ".",
        "Chart width: " + chartWd + ", height: " + chartHt + ".",
        "Chart 1X: " + chart1X + ", 1Y: " + chart1Y + ".",
        "Chart 2X: " + chart2X + ", 2Y: " + chart2Y + "."
    ];
    // Get the reference to the container element where the <p> elements will be added
    // Replace 'container' with the ID of your desired container element
    const container = document.getElementById('container'); 
    // Create and add the <p> elements with the respective texts
    texts.forEach(text => {
        const paragraph = document.createElement('p');
        paragraph.textContent = text;
        container.appendChild(paragraph);
    });
    

</script>
</body>
</html>
